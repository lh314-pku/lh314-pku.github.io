# Epipolar Geometry 对极几何

## Two-View Stereo 双目立体视觉

单视图下很难还原物体和场景的三维信息，为了解决这种深度信息丢失和视角不明确的问题，我们可以使用两台经过标定的相机进行拍摄，并基于两台相机的图像建立对应关系来还原场景的深度信息。

（复习：[相机标定](https://lh314-pku.github.io/notes/CV/Lecture06)）

双目立体视觉通过两台相机从不同视角拍摄同一场景，利用图像中的对应关系和几何约束（如对极几何）来恢复目标的三维信息。

通过相机的标定，可以规范化两台相机的参数，从而简化匹配点的寻找过程，减少复杂计算。这种方法无需显式三维推理，只需利用两视图的投影关系即可完成三维重建。

## Epipolar Geometry 对极几何

对极几何：使用图像中的点、线和平面来约束空间中的投影关系，帮助我们更高效地寻找匹配点（关键点对应关系），实现三维重建。

- 考虑两个相机中心 $O,O'$；

- **基线（Baseline）**：两个相机光心之间的连线。
  定义了相机间的关系；

- **对极点（Epipoles）**：$e, e'$，基线在图像平面上的投影点，分别位于左相机和右相机的图像中。
  对极点体现的是另一相机的投影位置。

- 考虑空间中一点 $X$，分别投影到 $x,x'$；

- **对极平面（Epipolar Plane）**：由$X$，$O$和$O'$三点确定的平面，$x,x',e,e'$为该平面与相机平面相交的点。

- **对极线（Epipolar Lines）**：连接对极点与投影点$ex,e'x'$，即对极平面与图像平面的交线。往往成对出现。

![image](https://lh314-pku.github.io/notes/CV/images/epipolar.png)

接下来考虑三种不同情况下的图像：交叉视角、平行视角、前移视角

### #1: Converging Cameras

即从不同下观察同一物体。

![](https://lh314-pku.github.io/notes/CV/images/epipolar%231.png)

在这种情况下，对极点是**有限点**，并且在图像中的可见性不确定（即基线可能穿越成像平面，也可能只是穿过了其延长部分）

### #2: Parallel to Image Plane

如果相机是左右平移拍摄的，即相机光轴平行于图像平面，则：

![](https://lh314-pku.github.io/notes/CV/images/epipolar%232.png)

这种情况下，对极点在**无穷远处**而非图像内部。在这种平行配置中，对极线不会像收敛相机那样相交于对极点，而是变成一组**平行线**。

### #3: Motion Perpendicular to the image plane

如果图片是相机沿着光轴移动的时候拍摄的：

![](https://lh314-pku.github.io/notes/CV/images/epipolar%233.png)

此时，极点与相机的主点重合，相机中心与对极点位于同一直线。

## Essential / Fundamental Matrix 本征/基本矩阵

### 1. 对极约束

然后我们用数学方法考虑对极约束。（图片可以参考上文Converging Cameras[传送门]()）

考虑图像中一点 $x$，我们可以在另一幅图像中的哪个位置观察到 $x'$？（二维图像没有深度信息，图像上一个点可能代表射线 $Ox$ 上的一系列点）

![](https://lh314-pku.github.io/notes/CV/images/epipolar%234.png)

我们将射线上所有的点沿极线投影到另一画面上，得到一条穿过 $e'$ 的直线，称为 $l'$；同样的，左侧图像中所有对应于 𝒙′ 的点必须沿着与 𝒙′ 对应的极线排列。那么我们可以确定两个条件：

1. 点 $x$ 对应的点 $x'$ 一定在直线 $l'$ 上；

2. 点 $x$ 一定在 $x'$ 投影回来的直线 $l$ 上。

每当两个点 $x$ 和 $x'$ 落在匹配的极线 $l$ 和 $l'$ 上时，对应它们的视觉射线会在空间中相交，即 $x$ 和 $x'$ 可能是同一个三维点 $X$ 的投影。

（注意，并非**一定**是同一个三维点的投影！）

通常情况下，由于噪声和校准不准确，两个射线在空间中不会完全相交！

![](https://lh314-pku.github.io/notes/CV/images/epipolar%235.png)

### 2. 本质矩阵

在**相机参数已经校准（Calibrates Case）** 的情况下，假设相机内参已知，并且世界坐标系匹配第一个相机的坐标系，则两个相机的投影矩阵分别为：$K[I,0]$ 和 $K'[R,t]$。

为了去除相机内参的影响，我们对图像中的点做校准（即**逆内参矩阵变换**），得到**归一化图像坐标**：

$$
x=K^{-1}x_{pixel}\cong[I,0]X=[I,0]\begin{pmatrix}
x\\1
\end{pmatrix}
\tag{1}
$$

$$
x'=K'^{-1}x'_{pixel}\cong[R,t]X=[R,t]\begin{pmatrix}
x\\1
\end{pmatrix}\tag{2}
$$

此处得到的 $x$ 和 $x'$ 是无量纲的平面坐标。由 $(1)(2)$ 式可知，$x'\cong Rx+t$。这意味着三个向量：$x'$、$Rx$、$t$ 是线性相关的（即三个向量共面）。那么这个约束条件可以写为混合积：$x'\cdot[t\times(Rx)]=0$。

> **三重积（triple product）**，又称**混合积**，也分为标量三重积和向量三重积。设三个向量：$a$、$b$、$c$。
> 
> **标量三重积**：$a\cdot(b\times c)$，结果是一个赝标量。（赝标量指宇称变换下符号改变的标量，虽然书写形式是标量，但是和向量一样可以构成场，也就是有方向性）
> 
> 几何意义：由三个向量定义的平行六面体，其体积等于三个标量标量三重积的绝对值。如果三个向量共面，则其标量三重积为 0 。（[其他性质](https://baike.baidu.com/item/混合积/10564182#1)）
> 
> **向量三重积**：$a\times(b\times c)$。

将上述约束进一步展开，得到：

$$
\begin{align}
x'\cdot[t\times(Rx)] & = 0\\
x'^T[t_{\times}]Rx&=0\\
x'^TEx&=0
\end{align}
$$

我们令 $[t_{\times}]R=E_{3\times3}$，称 $E$ 为 **Essential Matrix本质矩阵**。

> 注：形如$ax+by+c=0$的直线可以由$l^Tx=0$给出，其中$l=(a,b,c)^T$，$x=(x,y,1)^T$

由于 $x'^TEx=0$，我们有两种拆分：

- 令 $l'=Ex$，则有：$x'^Tl'=0$。（几何意义：本质矩阵 $E$ 将一个图像上的点映射到另一个平面上的对应**对极线**，而另一个点一定在这条对极线上。）

- 令 $l=E^Tx'$，则有：$l^Tx=0$。

对于对极点 $e$，其是所有对极线的交点，只能映射到另一个对极点，故有：$Ee=0$ 和 $E^Te'=0$。

（$E$ 矩阵是左点映右线，$E^T$ 反之）

$$
E = [t_\times] R
= 
\begin{bmatrix}
0 & -a_3 & a_2 \\ 
a_3 & 0 & -a_1 \\ 
-a_2 & a_1 & 0 
\end{bmatrix}
\begin{bmatrix}
r_{11} & r_{12} & r_{13} \\
r_{21} & r_{22} & r_{23} \\ 
r_{31} & r_{32} & r_{33}
\end{bmatrix}


$$

由于 $[t_{\times}]$ 是秩为 2 的矩阵，$R$ 的秩为 3，矩阵 $E$ 共 5 个自由度（平移三个，旋转三个，缩放二义性去掉一个）。

### 3. 基本矩阵

如果不知道相机内参（即没有校准），则有（）：

$$

$$
